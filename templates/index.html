<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake GPS Detector</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Fake GPS Detector</h1>
        <p>Klik tombol di bawah ini untuk mencatat data GPS Anda.</p>
        <button onclick="getLocation()">Ambil Lokasi</button>
        <h2>Data GPS Terkini</h2>
        <table id="gpsDataTable">
            <thead>
                <tr>
                    <th>Latitude</th>
                    <th>Longitude</th>
                    <th>Timestamp</th>
                    <th>Speed (km/h)</th>
                    <th>Anomaly</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data akan di-load di sini -->
            </tbody>
        </table>
    </div>

    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const data = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: new Date().toISOString(),
                        ip: '192.168.0.1',  // Placeholder IP
                        label: 'genuine'
                    };

                    fetch('/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(response => response.json())
                    .then(response => {
                        if (response.status === 'success') {
                            alert('Data berhasil disimpan');
                            loadData();
                        }
                    });
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function loadData() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#gpsDataTable tbody');
                    tableBody.innerHTML = '';
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.latitude}</td>
                            <td>${item.longitude}</td>
                            <td>${item.timestamp}</td>
                            <td>${item.speed}</td>
                            <td>${item.anomaly}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                });
        }

        // Load data saat halaman pertama kali dimuat
        window.onload = loadData;
    </script>
</body>
</html>
