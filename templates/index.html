<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake GPS Detector</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>Fake GPS Detector</h1>
        <p>Klik tombol di bawah ini untuk mencatat data lokasi Anda.</p>
        <button id="get-location">Dapatkan Lokasi</button>
        <p id="status"></p>
        <p id="anomaly"></p>

        <h2>Data Tersimpan</h2>
        <table id="data-table">
            <thead>
                <tr>
                    <th>Latitude</th>
                    <th>Longitude</th>
                    <th>Accuracy</th>
                    <th>Timestamp</th>
                    <th>Delta Time (s)</th>
                    <th>Distance (km)</th>
                    <th>Speed (km/h)</th>
                    <th>IP</th>
                    <th>Label</th>
                    <th>Anomaly</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data akan dimuat di sini -->
            </tbody>
        </table>
    </div>

    <script>
        document.getElementById('get-location').addEventListener('click', function() {
            navigator.geolocation.getCurrentPosition(function(position) {
                const data = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date().toISOString(),
                    ip: '192.168.0.1',  // Ganti dengan IP aktual jika diperlukan
                    label: 'genuine'
                };

                fetch('/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).then(response => response.json())
                  .then(data => {
                      document.getElementById('status').innerText = data.message;
                      document.getElementById('anomaly').innerText = `Anomaly detected: ${data.anomaly}`;
                      loadData();  // Muat ulang data dari server
                  });
            });
        });

        // Load data dari server dan tampilkan di tabel
        function loadData() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
                    tbody.innerHTML = '';  // Clear table body
                    data.forEach(row => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${row.latitude}</td>
                            <td>${row.longitude}</td>
                            <td>${row.accuracy}</td>
                            <td>${row.timestamp}</td>
                            <td>${row.delta_time}</td>
                            <td>${row.distance}</td>
                            <td>${row.speed}</td>
                            <td>${row.ip}</td>
                            <td>${row.label}</td>
                            <td>${row.anomaly}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
        }

        loadData();  // Load data when the page is loaded
    </script>
</body>
</html>
